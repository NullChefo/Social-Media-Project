# name: Build frontend-service hetzner
# on:
#   push:
#     branches:
#       - main
#       # - dev

# jobs:
#   build-and-push:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Login to GitHub Container Registry
#         uses: docker/login-action@v2
#         with:
#           registry: ghcr.io
#           username: ${{ github.actor }}
#           password: ${{ secrets.DOCKER_PASSWORD }}
#       - uses: actions/checkout@v2
#       - name: Goes to FE directory
#         run: |
#           cd front-end
#           docker build -t ghcr.io/nullchefo/social_media_project-front-end:latest-hetzner -f Dockerfile_Hetzner .

#       # - name: Build the Docker image
#       #   uses: docker/build-push-action@v2
#       #   with:
#       #     context: .
#       #     push: true
#       #     tags: ghcr.io/nullchefo/social_media_project-front-end:latest
#       #     file: ./Dockerfile
#       - name: Push to GitHub Packages with latest tag
#         run: docker push ghcr.io/nullchefo/social_media_project-front-end:latest-hetzner

name: Build frontend-service hetzner amd64 and arm64
on:
  push:
    branches:
      - main

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
      - name: Login to GitHub Container Registry
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - uses: actions/checkout@v2

      - name: Set up QEMU
        run: docker run --rm --privileged multiarch/qemu-user-static --reset -p yes

      - name: Build and push multi-architecture Docker image
        run: |
          cd front-end
          docker buildx create --use
          docker buildx build --push --platform linux/amd64,linux/arm64 -t ghcr.io/nullchefo/social_media_project-front-end:latest-hetzner -f Dockerfile_Hetzner .
